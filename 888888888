<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grape ‚ù§Ô∏è</title>

  <style>
    :root{
      --bg1:#ffd1dc; --bg2:#ffeef3; --ink:#3b2b2f;
      --shadow: 0 20px 60px rgba(0,0,0,.18);
      --env:#ff7aa8; --env2:#ff5f97; --paper:#fff8fb;
      --btn:#ff2f7c; --btn2:#ff5a9b; --white:#fff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", sans-serif;
      color:var(--ink);
      min-height:100vh;
      overflow:hidden;
      background:
        radial-gradient(1200px 600px at 70% 10%, var(--bg2), transparent 60%),
        radial-gradient(900px 600px at 20% 90%, #ffd6e5, transparent 55%),
        linear-gradient(160deg, var(--bg1), #ffe7ef);
    }

    /* fireworks canvas */
    #fx{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:9999;
      display:none;
    }

    /* falling petals */
    .petals{position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden;}
    .petal{
      position:absolute; width:14px; height:10px;
      border-radius:70% 30% 60% 40%;
      filter: blur(.1px);
      opacity:.9;
      transform: translateY(-20vh) rotate(0deg);
      animation: fall linear infinite;
    }
    @keyframes fall{ to{ transform: translateY(120vh) rotate(360deg); } }

    .wrap{position:relative; z-index:1; min-height:100vh; display:grid; place-items:center; padding:24px;}
    .card{
      width:min(920px, 96vw);
      border-radius:28px;
      padding:22px;
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.55);
    }

    .topbar{display:flex; align-items:center; justify-content:space-between; gap:14px; margin-bottom:12px;}
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px; border-radius:999px;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(255,255,255,.8);
      font-weight:800;
    }

    .btn{
      border:0; cursor:pointer;
      padding:12px 16px; border-radius:14px;
      font-weight:800; color:var(--white);
      background: linear-gradient(135deg, var(--btn), var(--btn2));
      box-shadow: 0 12px 28px rgba(255,47,124,.25);
      transition: transform .12s ease;
      user-select:none;
    }
    .btn:active{transform: translateY(1px) scale(.99)}
    .btn.secondary{
      color:var(--ink);
      background: rgba(255,255,255,.8);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow:none;
      font-weight:800;
    }

    .stage{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:18px;
      align-items:center;
      padding:10px 6px 6px;
    }
    @media (max-width:820px){
      .stage{grid-template-columns:1fr; gap:18px}
    }

    /* ----- Envelope Scene ----- */
    .scene{
      position:relative;
      height:440px;
      border-radius:24px;
      background:
        radial-gradient(800px 340px at 50% 25%, rgba(255,255,255,.7), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.35));
      border: 1px solid rgba(255,255,255,.8);
      overflow:hidden;
    }

    /* flowers around */
    .flower{
      position:absolute; width:90px; height:90px;
      opacity:.95;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.10));
      animation: floaty 4.2s ease-in-out infinite;
    }
    .flower:nth-child(2){animation-duration:5.2s}
    .flower:nth-child(3){animation-duration:4.8s}
    .flower:nth-child(4){animation-duration:5.7s}
    @keyframes floaty{
      0%,100%{ transform: translateY(0px) rotate(-1deg) }
      50%{ transform: translateY(-10px) rotate(2deg) }
    }
    .flower svg{width:100%; height:100%}

    .envelope-wrap{
      position:absolute;
      left:50%;
      top:58%;
      transform: translate(-50%, -50%);
      width:min(420px, 86%);
      height:260px;
    }

    .envelope{
      position:absolute;
      inset:0;
      border-radius:18px;
      background: linear-gradient(180deg, var(--env), var(--env2));
      box-shadow: 0 18px 45px rgba(255,95,151,.25);
      overflow:hidden;
    }

    .env-front{
      position:absolute; inset:0;
      background:
        linear-gradient(135deg, rgba(255,255,255,.25), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,.06), transparent 50%);
      opacity:.8; pointer-events:none;
    }

    .env-bottom{
      position:absolute; inset:0;
      clip-path: polygon(0 35%, 50% 78%, 100% 35%, 100% 100%, 0 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(0,0,0,.06));
      opacity:.55; pointer-events:none;
    }

    .flap{
      position:absolute; left:0; right:0; top:0; height:60%;
      background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.06));
      clip-path: polygon(0 0, 100% 0, 50% 92%);
      transform-origin: top;
      transform: rotateX(0deg);
      transition: transform .65s cubic-bezier(.2,.9,.2,1);
      z-index:4;
      filter: drop-shadow(0 10px 10px rgba(0,0,0,.12));
    }

    /* heart seal */
    .seal{
      position:absolute; left:50%; top:64%;
      transform: translate(-50%, -50%);
      width:54px; height:54px; border-radius:999px;
      display:grid; place-items:center;
      font-size:26px;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 14px 30px rgba(0,0,0,.14);
      z-index:3;
      user-select:none;
      animation: sealPulse 1.6s ease-in-out infinite;
    }
    @keyframes sealPulse{
      0%,100%{ transform: translate(-50%,-50%) scale(1) }
      50%{ transform: translate(-50%,-50%) scale(1.06) }
    }

    .letter{
      position:absolute;
      left:50%;
      top:12%;
      transform: translateX(-50%);
      width:86%;
      height:82%;
      background: linear-gradient(180deg, var(--paper), #ffffff);
      border-radius:16px;
      border:1px solid rgba(0,0,0,.06);
      box-shadow: 0 18px 40px rgba(0,0,0,.12);
      z-index:2;
      transition: transform .75s cubic-bezier(.2,.9,.2,1), opacity .25s ease;
      transform: translateX(-50%) translateY(110px);
      opacity:0;
      overflow:hidden;
    }
    .letter::before{
      content:"";
      position:absolute;
      inset:-40px -40px auto -40px;
      height:140px;
      background:
        radial-gradient(220px 120px at 30% 60%, rgba(255,47,124,.14), transparent 70%),
        radial-gradient(200px 110px at 80% 20%, rgba(255,95,151,.14), transparent 70%);
      transform: rotate(-2deg);
    }

    .letter-inner{
      position:relative;
      padding:16px 16px 14px;
      height:100%;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .letter h2{ margin:2px 0 0; font-size:20px; letter-spacing:.2px; }
    .tiny{ opacity:.85; font-size:13px; font-weight:800; }
    .sig{
      margin-top:auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      font-weight:800;
    }

    /* 9:16 video box (centered) */
    .video-box{
      margin-top: 6px;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,.06);
      background: rgba(255,255,255,.7);
      box-shadow: 0 14px 30px rgba(0,0,0,.10);
      aspect-ratio: 9 / 16;
      width: min(320px, 100%);
      margin-left:auto;
      margin-right:auto;
      position:relative;
    }
    .video-box video{
      width:100%;
      height:100%;
      display:block;
      object-fit:cover;
      background:#000;
    }

    /* autoplay fallback overlay */
    .playOverlay{
      position:absolute; inset:0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.28);
      color:#fff;
      font-weight:900;
      text-align:center;
      padding:16px;
      cursor:pointer;
      user-select:none;
    }
    .playOverlay.show{display:grid;}

    .open .flap{ transform: rotateX(165deg); }
    .open .letter{ transform: translateX(-50%) translateY(-18px); opacity:1; }
    .open .seal{
      opacity:0;
      transform: translate(-50%,-50%) scale(.85);
      transition: opacity .25s ease, transform .25s ease;
      pointer-events:none;
      animation:none;
    }

    /* right panel (‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà‡∏´‡∏±‡∏ß + ‡∏õ‡∏∏‡πà‡∏°) */
    .panel{ padding:14px 14px 6px; }
    .panel h1{ margin:6px 0 6px; font-size:28px; line-height:1.15; }
    .panel .lead{ margin:0 0 14px; font-size:16px; opacity:.9; line-height:1.55; }
    .controls{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }

    /* screens */
    .screen{ display:none; padding:10px; }
    .screen.active{ display:block; }

    /* screen2 (‡∏ã‡πà‡∏≠‡∏ô panel ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏û‡∏ß‡∏Å ‚Äú‡∏´‡∏ô‡πâ‡∏≤2/‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‚Äù) */
    #screen2 .panel{ display:none; }
    #screen2 .stage{ grid-template-columns:1fr; }

    /* screen2 */
    .qbox{
      height:440px;
      border-radius:24px;
      background:
        radial-gradient(900px 420px at 50% 30%, rgba(255,255,255,.8), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.35));
      border: 1px solid rgba(255,255,255,.8);
      position:relative;
      overflow:hidden;
      display:grid;
      place-items:center;
      text-align:center;
      padding:18px;
    }
    .qbox h2{
      font-size:34px;
      margin:0 0 10px;
      text-align:center;
      width:100%;
    }
    .qbox .sub{ margin:0 0 16px; font-size:16px; opacity:.9; }
    .choices{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:6px; }
    .btn.big{ padding:14px 18px; border-radius:16px; font-size:16px; }
    .no-btn{ position:relative; }

    /* Modal */
    .modal{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.25);
      display:none;
      place-items:center;
      padding:18px;
    }
    .modal.show{display:grid;}

    /* ‚úÖ ‡πÇ‡∏°‡∏î‡∏≠‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏¥‡∏° + ‡∏Å‡∏£‡∏≠‡∏ö‡∏ä‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô */
    .modal-card{
      width:min(760px, 92vw);
      border-radius:22px;
      background: rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.85);
      box-shadow: var(--shadow);
      padding:10px; /* ‡∏ä‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô */
      text-align:left;
    }

    /* ‚úÖ 50/50 (‡∏ö‡∏≤‡∏•‡∏≤‡∏ô‡∏ã‡πå) */
    .modal-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-items:stretch;
    }
    @media (max-width:560px){
      .modal-grid{ grid-template-columns:1fr; text-align:center; }
      .modal-card{ text-align:center; }
    }

    /* ‚úÖ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ ‚Äú‡∏£‡∏π‡∏õ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‚Äù = ‡πÑ‡∏°‡πà‡∏¢‡∏∑‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏™‡∏π‡∏á */
    .left-cell{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:6px;
      border-radius:16px;
      background: rgba(255,255,255,.55);
      border:1px solid rgba(0,0,0,.06);
    }
    .polaroid{
      width:min(320px, 100%);
      aspect-ratio: 3 / 4;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.06);
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
      background:#eee;
    }
    .polaroid img{ width:100%; height:100%; object-fit:cover; display:block; }

    .success-text{
      border-radius:16px;
      border:1px solid rgba(0,0,0,.06);
      background: rgba(255,255,255,.75);
      box-shadow: 0 14px 30px rgba(0,0,0,.08);
      padding:14px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      min-height: 0;
    }
    .success-text h3{ margin:2px 0 10px; font-size:26px; }
    .success-text p{
      margin:0;
      line-height:1.55;
      opacity:.95;
      white-space:pre-wrap;
      font-weight:650;
    }

    .modal-actions{
      display:flex;
      gap:10px;
      justify-content:flex-end;
      margin-top:10px;
      padding: 0 2px 2px;
    }
    @media (max-width:560px){ .modal-actions{ justify-content:center; } }
  </style>
</head>

<body>
  <canvas id="fx"></canvas>
  <div class="petals" id="petals"></div>

  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div class="badge">üíå <span id="badgeText">Grape ‚ù§Ô∏è</span></div>
        <button class="btn secondary" id="resetBtn" type="button">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      </div>

      <!-- SCREEN 1 -->
      <div class="screen active" id="screen1">
        <div class="stage">
          <div class="scene">
            <!-- flowers -->
            <div class="flower" style="left:-8px; top:-10px; transform:rotate(-12deg)">
              <svg viewBox="0 0 120 120" aria-hidden="true">
                <circle cx="60" cy="60" r="12" fill="#FFD166"/>
                <g fill="#FF5A9B">
                  <ellipse cx="60" cy="22" rx="14" ry="20"/>
                  <ellipse cx="60" cy="98" rx="14" ry="20"/>
                  <ellipse cx="22" cy="60" rx="20" ry="14"/>
                  <ellipse cx="98" cy="60" rx="20" ry="14"/>
                  <ellipse cx="33" cy="33" rx="16" ry="12" transform="rotate(-45 33 33)"/>
                  <ellipse cx="87" cy="33" rx="16" ry="12" transform="rotate(45 87 33)"/>
                  <ellipse cx="33" cy="87" rx="16" ry="12" transform="rotate(45 33 87)"/>
                  <ellipse cx="87" cy="87" rx="16" ry="12" transform="rotate(-45 87 87)"/>
                </g>
              </svg>
            </div>

            <div class="flower" style="right:-14px; top:-6px; transform:rotate(18deg)">
              <svg viewBox="0 0 120 120" aria-hidden="true">
                <circle cx="60" cy="60" r="12" fill="#FFE08A"/>
                <g fill="#FF7AA8">
                  <ellipse cx="60" cy="22" rx="14" ry="20"/>
                  <ellipse cx="60" cy="98" rx="14" ry="20"/>
                  <ellipse cx="22" cy="60" rx="20" ry="14"/>
                  <ellipse cx="98" cy="60" rx="20" ry="14"/>
                  <ellipse cx="33" cy="33" rx="16" ry="12" transform="rotate(-45 33 33)"/>
                  <ellipse cx="87" cy="33" rx="16" ry="12" transform="rotate(45 87 33)"/>
                  <ellipse cx="33" cy="87" rx="16" ry="12" transform="rotate(45 33 87)"/>
                  <ellipse cx="87" cy="87" rx="16" ry="12" transform="rotate(-45 87 87)"/>
                </g>
              </svg>
            </div>

            <div class="flower" style="left:-16px; bottom:-18px; transform:rotate(10deg)">
              <svg viewBox="0 0 120 120" aria-hidden="true">
                <circle cx="60" cy="60" r="12" fill="#FFD166"/>
                <g fill="#FF2F7C">
                  <ellipse cx="60" cy="22" rx="14" ry="20"/>
                  <ellipse cx="60" cy="98" rx="14" ry="20"/>
                  <ellipse cx="22" cy="60" rx="20" ry="14"/>
                  <ellipse cx="98" cy="60" rx="20" ry="14"/>
                  <ellipse cx="33" cy="33" rx="16" ry="12" transform="rotate(-45 33 33)"/>
                  <ellipse cx="87" cy="33" rx="16" ry="12" transform="rotate(45 87 33)"/>
                  <ellipse cx="33" cy="87" rx="16" ry="12" transform="rotate(45 33 87)"/>
                  <ellipse cx="87" cy="87" rx="16" ry="12" transform="rotate(-45 87 87)"/>
                </g>
              </svg>
            </div>

            <div class="flower" style="right:-10px; bottom:-14px; transform:rotate(-14deg)">
              <svg viewBox="0 0 120 120" aria-hidden="true">
                <circle cx="60" cy="60" r="12" fill="#FFE08A"/>
                <g fill="#FF5A9B">
                  <ellipse cx="60" cy="22" rx="14" ry="20"/>
                  <ellipse cx="60" cy="98" rx="14" ry="20"/>
                  <ellipse cx="22" cy="60" rx="20" ry="14"/>
                  <ellipse cx="98" cy="60" rx="20" ry="14"/>
                  <ellipse cx="33" cy="33" rx="16" ry="12" transform="rotate(-45 33 33)"/>
                  <ellipse cx="87" cy="33" rx="16" ry="12" transform="rotate(45 87 33)"/>
                  <ellipse cx="33" cy="87" rx="16" ry="12" transform="rotate(45 33 87)"/>
                  <ellipse cx="87" cy="87" rx="16" ry="12" transform="rotate(-45 87 87)"/>
                </g>
              </svg>
            </div>

            <div class="envelope-wrap" id="envWrap">
              <div class="letter" id="letter" aria-live="polite">
                <div class="letter-inner">
                  <div class="tiny" id="letterTo">‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ ‚ú®</div>
                  <h2 id="letterTitle">Grape ‚ù§Ô∏è</h2>

                  <div class="video-box">
                    <video id="loveVideo" playsinline preload="auto"></video>
                    <div class="playOverlay" id="playOverlay">‡πÅ‡∏ï‡∏∞/‡∏Ñ‡∏•‡∏¥‡∏Å 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‚ñ∂</div>
                  </div>

                  <div class="sig">
                    <span id="letterFrom">‚Äî ‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤</span>
                    <span class="tiny" id="letterDate"></span>
                  </div>
                </div>
              </div>

              <div class="envelope" id="envelope">
                <div class="flap"></div>
                <div class="env-bottom"></div>
                <div class="env-front"></div>
                <div class="seal" aria-hidden="true">üíó</div>
              </div>
            </div>
          </div>

          <div class="panel">
            <h1 id="headline">‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á‡∏î‡∏π‡∏´‡∏ô‡πà‡∏≠‡∏¢ üíå</h1>
            <p class="lead" id="subline">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏õ‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á) üé•üîä</p>

            <div class="controls">
              <button class="btn" id="toggleBtn" type="button">‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á</button>
              <button class="btn secondary" id="nextBtn" type="button" style="display:none;">‡πÑ‡∏õ‡∏ï‡πà‡∏≠ ‚ûú</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SCREEN 2 -->
      <div class="screen" id="screen2">
        <div class="stage">
          <div class="qbox" id="qbox">
            <div>
              <h2 id="questionTitle">‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ü‡∏ô‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°? üíñ</h2>
              <p class="sub" id="questionSub">‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ô‡πâ‡∏≤‚Ä¶</p>
              <div class="choices">
                <button class="btn big" id="yesBtn" type="button">‡∏ï‡∏Å‡∏•‡∏á ‚úÖ</button>
                <button class="btn big secondary no-btn" id="noBtn" type="button">‡πÑ‡∏°‡πà üòù</button>
              </div>
              <div style="margin-top:14px;">
                <button class="btn secondary" id="backBtn" type="button">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
              </div>
            </div>

            <!-- Modal -->
            <div class="modal" id="modal">
              <div class="modal-card">
                <div class="modal-grid">
                  <div class="left-cell">
                    <div class="polaroid">
                      <img id="successImg" alt="photo"/>
                    </div>
                  </div>
                  <div class="success-text">
                    <h3 id="successTitle">‡πÑ‡∏≠‡πâ‡∏≠‡πâ‡∏ß‡∏ô‡∏ô‡∏ô ü´∂</h3>
                    <p id="successBody"></p>
                  </div>
                </div>
                <div class="modal-actions">
                  <button class="btn" id="closeModal" type="button">‡∏õ‡∏¥‡∏î</button>
                </div>
              </div>
            </div>

          </div>

          <div class="panel"></div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const CONFIG = {
      badgeText: "Grape ‚ù§Ô∏è",
      headline: "‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á‡∏î‡∏π‡∏´‡∏ô‡πà‡∏≠‡∏¢ üíå",
      subline: "‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏õ‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á) üé•üîä",

      videoSrc: "grape.mp4",
      successImageSrc: "77.jpg",

      letterTo: "‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ ‚ú®",
      letterTitle: "Grape ‚ù§Ô∏è",
      letterFrom: "‚Äî ‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤",

      questionTitle: "‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ü‡∏ô‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°? üíñ",
      questionSub: "‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ô‡πâ‡∏≤‚Ä¶",

      successTitle: "‡πÑ‡∏≠‡πâ‡∏≠‡πâ‡∏ß‡∏ô‡∏ô‡∏ô ü´∂",
      successSideText:
`‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ü‡∏ô‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞ üíû ‡∏´‡πâ‡∏≤‡∏°‡∏î‡∏∑‡πâ‡∏≠‡∏ô‡∏∞ üò§
‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡∏û‡∏π‡∏î‡∏ï‡∏£‡∏á‡πÜ ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
‡∏≠‡∏¢‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏á‡∏ö‡πà‡∏≠‡∏¢‡πÜ ‡∏Ç‡∏Å‡∏õ‡∏•‡∏≠‡∏ö ü§£
‡πÄ‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ô‡∏∞
‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡πÄ‡∏ò‡∏≠‡∏à‡∏∞‡πÄ‡∏à‡∏≠‡∏≠‡∏∞‡πÑ‡∏£ ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏Å‡πá‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÜ‡πÄ‡∏ò‡∏≠‡∏ï‡∏•‡∏≠‡∏î
‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏°‡∏≠‡∏ô‡∏∞
‡πÑ‡∏≠‡πâ‡∏≠‡πâ‡∏ß‡∏ô‡∏ô‡∏ô ü´∂`,

      PETAL_COUNT: 26,
      PETAL_MIN_DUR: 7,
      PETAL_MAX_DUR: 14,

      NO_ESCAPE_DISTANCE: 110,

      FX_BURSTS: 3,
      FX_PARTICLES: 70
    };

    const $ = (id) => document.getElementById(id);

    $("badgeText").textContent = CONFIG.badgeText;
    $("headline").textContent = CONFIG.headline;
    $("subline").textContent = CONFIG.subline;

    $("letterTo").textContent = CONFIG.letterTo;
    $("letterTitle").textContent = CONFIG.letterTitle;
    $("letterFrom").textContent = CONFIG.letterFrom;

    $("questionTitle").textContent = CONFIG.questionTitle;
    $("questionSub").textContent = CONFIG.questionSub;

    $("successTitle").textContent = CONFIG.successTitle;
    $("successBody").textContent = CONFIG.successSideText;
    $("successImg").src = CONFIG.successImageSrc;

    const d = new Date();
    $("letterDate").textContent = d.toLocaleDateString("th-TH", { year:"numeric", month:"short", day:"numeric" });

    // petals
    const petals = $("petals");
    const petalColors = ["#ff5a9b", "#ff7aa8", "#ff2f7c", "#ffd166", "#ffe08a"];
    function rand(min,max){ return Math.random()*(max-min)+min; }
    function makePetals(){
      petals.innerHTML = "";
      for(let i=0;i<CONFIG.PETAL_COUNT;i++){
        const s = document.createElement("span");
        s.className = "petal";
        const size = rand(10,18);
        s.style.width = size + "px";
        s.style.height = (size*0.72) + "px";
        s.style.left = rand(-5, 105) + "vw";
        s.style.top = rand(-30, -5) + "vh";
        s.style.background = petalColors[Math.floor(Math.random()*petalColors.length)];
        s.style.animationDuration = rand(CONFIG.PETAL_MIN_DUR, CONFIG.PETAL_MAX_DUR) + "s";
        s.style.animationDelay = rand(-CONFIG.PETAL_MAX_DUR, 0) + "s";
        s.style.opacity = rand(0.55, 0.95);
        s.style.transform = `translateY(-20vh) rotate(${rand(0,360)}deg)`;
        petals.appendChild(s);
      }
    }
    makePetals();

    // video
    const loveVideo = $("loveVideo");
    const playOverlay = $("playOverlay");
    loveVideo.src = CONFIG.videoSrc;
    loveVideo.controls = false;
    loveVideo.playsInline = true;
    loveVideo.preload = "auto";

    async function playWithSoundFromUserGesture(){
      playOverlay.classList.remove("show");
      try{
        loveVideo.muted = false;
        loveVideo.currentTime = 0;
        await loveVideo.play();
      }catch(e){
        playOverlay.classList.add("show");
      }
    }
    playOverlay.addEventListener("click", async ()=>{
      playOverlay.classList.remove("show");
      try{
        loveVideo.muted = false;
        await loveVideo.play();
      }catch(e){
        playOverlay.classList.add("show");
      }
    });

    // envelope toggle
    const envWrap = $("envWrap");
    const toggleBtn = $("toggleBtn");
    const nextBtn = $("nextBtn");
    let isOpen = false;

    function setOpen(open){
      isOpen = open;
      envWrap.classList.toggle("open", isOpen);
      toggleBtn.textContent = isOpen ? "‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á" : "‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á";
      nextBtn.style.display = isOpen ? "inline-flex" : "none";

      if (isOpen) playWithSoundFromUserGesture();
      else { loveVideo.pause(); playOverlay.classList.remove("show"); }
    }
    toggleBtn.addEventListener("click", () => setOpen(!isOpen));

    // screens
    const screen1 = $("screen1");
    const screen2 = $("screen2");
    function goScreen(n){
      screen1.classList.toggle("active", n===1);
      screen2.classList.toggle("active", n===2);
    }
    nextBtn.addEventListener("click", ()=> goScreen(2));
    $("backBtn").addEventListener("click", ()=> goScreen(1));

    // reset
    $("resetBtn").addEventListener("click", ()=>{
      goScreen(1);
      setOpen(false);
      makePetals();
      hideModal();
      stopFX();
    });

    // no escape
    const qbox = $("qbox");
    const noBtn = $("noBtn");
    function escapeNo(){
      const boxRect = qbox.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();
      const padding = 20;
      const maxX = boxRect.width - btnRect.width - padding;
      const maxY = boxRect.height - btnRect.height - padding;
      const x = rand(padding, Math.max(padding, maxX));
      const y = rand(padding, Math.max(padding, maxY));
      noBtn.style.position = "absolute";
      noBtn.style.left = x + "px";
      noBtn.style.top = y + "px";
    }
    qbox.addEventListener("mousemove", (e)=>{
      const r = noBtn.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top + r.height/2;
      const dx = e.clientX - cx;
      const dy = e.clientY - cy;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < CONFIG.NO_ESCAPE_DISTANCE){ escapeNo(); }
    });
    noBtn.addEventListener("touchstart", (e)=>{ e.preventDefault(); escapeNo(); }, {passive:false});

    // modal
    const modal = $("modal");
    function showModal(){ modal.classList.add("show"); }
    function hideModal(){ modal.classList.remove("show"); }

    $("closeModal").addEventListener("click", ()=>{ hideModal(); stopFX(); });
    modal.addEventListener("click", (e)=>{ if(e.target === modal){ hideModal(); stopFX(); } });

    // fireworks / confetti
    const fx = document.getElementById("fx");
    const ctx = fx.getContext("2d");
    let particles = [];
    let fxRAF = null;
    let fxEndAt = 0;

    function resizeFX(){
      fx.width = Math.floor(window.innerWidth * devicePixelRatio);
      fx.height = Math.floor(window.innerHeight * devicePixelRatio);
      fx.style.width = window.innerWidth + "px";
      fx.style.height = window.innerHeight + "px";
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    window.addEventListener("resize", resizeFX);

    function burst(x,y){
      const colors = ["#ff2f7c","#ff5a9b","#ff7aa8","#ffd166","#ffe08a","#ffffff"];
      for(let i=0;i<CONFIG.FX_PARTICLES;i++){
        const a = Math.random()*Math.PI*2;
        const sp = rand(2.5, 7.5);
        particles.push({
          x,y,
          vx: Math.cos(a)*sp,
          vy: Math.sin(a)*sp - rand(0.5,2),
          g: rand(0.04,0.08),
          life: rand(240,370),
          r: rand(2,4),
          c: colors[(Math.random()*colors.length)|0],
          rot: rand(0,Math.PI*2),
          vr: rand(-0.25,0.25)
        });
      }
    }

    function startFX(){
      resizeFX();
      fx.style.display = "block";
      fxEndAt = Date.now() + 7000;

      for(let b=0;b<CONFIG.FX_BURSTS;b++){
        const x = window.innerWidth * rand(0.25, 0.75);
        const y = window.innerHeight * rand(0.2, 0.45);
        burst(x,y);
      }

      if(!fxRAF) loopFX();
    }

    function loopFX(){
      fxRAF = requestAnimationFrame(loopFX);
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

      particles = particles.filter(p => p.life > 0);
      for(const p of particles){
        p.life -= 1;
        p.vy += p.g;
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;

        const alpha = Math.max(0, Math.min(1, p.life/60));
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle = p.c;
        ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
        ctx.restore();
      }

      if(Date.now() > fxEndAt && particles.length === 0){
        stopFX();
      }
    }

    function stopFX(){
      if(fxRAF){
        cancelAnimationFrame(fxRAF);
        fxRAF = null;
      }
      particles = [];
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
      fx.style.display = "none";
    }

    // yes click => fireworks + modal
    $("yesBtn").addEventListener("click", ()=>{
      startFX();
      showModal();
    });

    // start
    setOpen(false);
  </script>
</body>
</html>
      





